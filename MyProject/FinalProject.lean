/-  Let I âŠ‚ k[x1, . . . , xn] be an ideal that can be generated by r elements.
Show that every irreducible component of V (I) has dimension â‰¥ n âˆ’ r.
-/

import Mathlib.Algebra.MvPolynomial.Basic
import Mathlib.RingTheory.Algebraic

namespace Mv_Polynomial

variable {k : Type*} [CommSemiring k] {Ïƒ :Type*} {s: Ïƒ â†’ â„•} {a: k} {i: Ïƒ} {p: MvPolynomial Ïƒ k} {I: Set (MvPolynomial Ïƒ k)} {Î² : â„•}

/- The algebraic set of a set of polynomials S âŠ† k[xâ‚, ... xâ‚™] is the set
of elements x âˆˆ kâ¿ such that x is a root of all the polynomials in S -/
def IsAlgebraic (S: Set (MvPolynomial Ïƒ k)) : Set (Ïƒ â†’ k) := {x : (Ïƒ â†’ k) | âˆ€ f âˆˆ S, (MvPolynomial.eval x) f = 0}

/- Here the underlying set is a set of elements in kâ¿ -/
structure AlgebraicSet (k: Type*) [CommSemiring k] (Ïƒ : Type*) where
  (carrier: Set (Ïƒ â†’ k))
  (is_algebraic: âˆƒ S : Set (MvPolynomial Ïƒ k), carrier = IsAlgebraic S)

--def CoordRing (X: AlgebraicSet k Ïƒ) := (Ïƒ â†’ k) / X

/- A variety is an irreducible algebraic set -/
def IsVariety (X: AlgebraicSet k Ïƒ) (Uâ‚ Uâ‚‚: AlgebraicSet k Ïƒ) := X.carrier â‰  âˆ… âˆ§ X.carrier â‰  Uâ‚.carrier âˆ§ X.carrier â‰  Uâ‚‚.carrier âˆ§ X.carrier â‰  Uâ‚.carrier âˆª Uâ‚‚.carrier

/- Every variety V has a dimension which is the transcendence degree of function
field k(V) over k; here I am just defining it as a number â‰¥ 0 -/
structure Variety (X: AlgebraicSet k Ïƒ) where
  (carrier: Set (Ïƒ â†’ k))
  (is_variety: âˆ€ Uâ‚ Uâ‚‚ : AlgebraicSet k Ïƒ, IsVariety X Uâ‚ Uâ‚‚)
  (dimension : â„•)

-- cannot find anything related to transcendence degree in Mathlib, but dim could also just be defined as some non-neg number in lean since the definition is not too important for proving this question
--def Dim (X: AlgSet) := Algebra.Transcendental (Mv_Polynomial X k) k

variable (A : AlgebraicSet k Ïƒ)

/- If Y is a subvariety of X, then the codimension of Y in X is dim X - dim Y -/
def Codim (X: Variety A) (Y: Variety A) (Y_sub_X: Y.carrier âŠ† X.carrier) := X.dimension - Y.dimension


/- Next two theorems are to help prove the main problem -/

/-
Theorem 2.5.3:
If Y is a proper subvariety of X âŠ† Am then dim Y < dim X.
Proof:
Let n = dim X.
Then any n+1 of the coordinate functions x1, . . . , xm are algebraically dependent as elements of k(X), and also as elements of k(Y ).
Therefore dimY â‰¤dimX.
Assume that dim Y = dim X .
We will derive the contradiction Y = X by showing that I(Y) âŠ† I(X).
Since dimY = n there are coordinate functions xi1,...,xin whose images are algebraically independent in k(Y). Then xi1 , . . . , xin must be algebraically independent in k(X).
Let u âˆˆ Î“(X) be non- zero.
Then u depends algebraically on xi1 , . . . , xin , i.e. there is a polynomial a âˆˆ k[t1,...,tn+1] such that
a(u,xi1,...,xin)=ak(xi1,...,xin)uk +Â·Â·Â·+a1(xi1,...,xin)u+a0(xi1,...,xin)=0 on X.
Since Î“(X) is a domain we may assume a is irreducible and a0(xi1 , . . . , xin ) is non-zero on X.
Then a(u,xi1,...,xin)=0 on Y since Y âŠ† X so if u=0 on Y then a0(xi1,...,xin) = 0 on Y, a contradiction since xi1,...,xin are algebraically independent in k(Y ).
Since u â‰  0 on X implies u  â‰  0 on Y we have that I(Y ) âŠ† I(X).
-/

theorem ProperSubVarietyDim (X Y: Variety A) (properSub: Y.carrier âŠ‚ X.carrier) : Y.dimension < X.dimension := by
  sorry

/-
Let f âˆˆ k[x1, . . . , xn] be a non-constant irreducible polynomial. Then V(f) âŠ† ğ”¸â¿ has codimension 1.

Proof:
Let X = V(f).
Suppose that xâ‚™ appears in the expression of f.
Then x1, . . . , xn-1 are algebraically independent in k(X).
Indeed, if they are not then there is a polynomial g involving only the variables x1,...,xnâˆ’1 that is zero on X.
Then g âˆˆ I(X) = âŸ¨fâŸ©, so f | g and xn appears in the expression for g, a contradiction.
Therefore dim X â‰¥ n âˆ’ 1, and Theorem 2.5.3 implies that dim X = n âˆ’ 1, so codim X = 1.
-/

theorem IrredCodim1 (f: MvPolynomial Ïƒ k) (Vf: Variety A) (kn: Variety A) (h: Vf.carrier âŠ† kn.carrier): kn.dimension - Vf.dimension = 1 := by
  sorry

/-
Let I âŠ‚ k[x1, . . . , xn] be an ideal that can be generated by r elements.
Show that every irreducible component of V (I) has dimension â‰¥ n âˆ’ r.
-/

-- need to revise the arguments to this
theorem IrredDim (I: Set (MvPolynomial r k)) (W: Variety A) {r: â„•} {n: â„•} : W.dimension â‰¥ n - r := by
  sorry
  /- induction on r using d:
  if d = 1:
  then I = âŸ¨aâ‚âŸ© âŠ† k[xâ‚, ..., xâ‚™]
  so V(I) = V(aâ‚) = V(fâ‚) âˆ© ... âˆ© V(fâ‚˜) where fáµ¢ is an irreducible factor of aâ‚
  since k is a UFD, each V(fáµ¢) is irreducible and has a codimension of 1 in ğ”¸â¿
  hence dim V(fáµ¢) â‰¥ n - 1 (from equation codimâ‚–(V(fáµ¢)) = dim k - dim V(fáµ¢)


  if d = r - 1
  Let V(I) = V(a1, ... ar-1) = âˆª Wáµ¢ where Wáµ¢ is irreducible and dim Wáµ¢ â‰¥ n - r + 1
  X = V(a1, ... ar) = V(a1, ... ar-1) âˆ© V(ar) = âˆª Wáµ¢ âˆ© V(aáµ£)
  X is the union of irreducible decompositions of âˆª Wáµ¢ âˆ© V(aáµ£)
  We show every irreducible component W of Wáµ¢ âˆ© V(aáµ£) has dim W â‰¥ n - r

  If polynomial aáµ£ = 0:
  then all of ğ”¸â¿ is its algebraic set, so Wáµ¢ âˆ© V(aáµ£) = Wáµ¢
  Since Wáµ¢ is irreducible, W = Wáµ¢
  so dim W â‰¥ n - r + 1 â‰¥ n - r

  If aáµ£ â‰  0 in coordinate ring of Wáµ¢:
  Every irreducible component of Wáµ¢ âˆ© V(aáµ£) has codimension 1 in Wáµ¢
  So dim W = dim (Wáµ¢) - 1 â‰¥ n - r + 1 - 1 = n - r

  -/
